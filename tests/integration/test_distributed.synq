// MIT License
// 
// Copyright (c) 2025 SynQ Contributors
// 
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
// 
// The above copyright notice and this permission notice shall be included in all
// copies or substantial portions of the Software.
// 
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
// SOFTWARE.
// File: tests/integration/test_distributed.synq

use stdlib "distributed.synq"

print("[DISTRIBUTED] Registering compute nodes")
register_node("cpu0", "CPU")
register_node("qsim1", "QUANTUM_SIM")

print("[DISTRIBUTED] Dispatching async task")
res1 = dispatch_async("task1", "simulate_circuit()", "QUANTUM_SIM")
print("Task 1 launched")

res2 = dispatch_async("task2", "print('Hello')", "CPU")
print("Task 2 launched")

print("[DISTRIBUTED] Waiting for results...")
print(res1.output)
print(res2.output)

print("[DISTRIBUTED] Batch test")
tasks = [
    { id: "t3", code: "entangle(q1, q2)", preferred: "QUANTUM_SIM" },
    { id: "t4", code: "measure_all()", preferred: "CPU" }
]

batch_results = dispatch_batch(tasks)
for r in batch_results {
    print(r.task_id + ": " + r.output)
}